---
title: "Truffle Monitoring"
author: "Lia Baumann"
date: "2024-03-05"
output: github_document
bibliography: references.json
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Basis

The basis for the research about Truffle Monitoring data is described in detail in these publications:
@molinierFirstIdentificationPolymorphic2013
@molinierSSRbasedIdentificationGenetic2016
@molinierFinescaleGeneticStructure2016
@staubliHiddenFairyRings2022
@steidingerFallSummerTruffle2022
@legendreComparisonMantelTest2010


```{r Tabellen laden, message=FALSE, warning=FALSE, include=FALSE}
library(readxl)
library(knitr)
library(tidyverse)
library(ggplot2)
theme_set(theme_bw())
library(sf)
library(ggspatial)
library(rnaturalearth)
library(envalysis)
library(forcats)
T_all <- read_excel("Tuaest_Master_genMonit_haploid_MP_2024.xlsx")
coord <- read_excel("Koordinaten_2024.xlsx")
```

## Monitoring Sites

```{r Maps laden, echo=FALSE, warning=FALSE}
europe <- ne_countries(scale="medium",returnclass="sf",continent="europe")
europe_points <- st_centroid(europe)
europe_points <- cbind(europe,st_coordinates(st_centroid(europe$geometry)))

ggplot(data=europe) + geom_sf() +
  geom_text(data=europe_points,aes(x=X,y=Y,label = name),
            color = "darkmagenta", fontface = "bold", check_overlap = FALSE) +
  annotation_scale(location = "bl", width_hint = 0.5) +
  #annotation_north_arrow(location = "bl",which_north = "true",
  #                       pad_x = unit(0.5,"in"),pad_y=unit(0.5,"in"),
  #                       style=north_arrow_fancy_orienteering) +
  coord_sf(xlim = c(5.5,11), ylim = c(45.5,48.5), expand = FALSE) +
  geom_point(data=coord,
             aes(x=LON, y=LAT),shape=20,color="darkcyan", fill = "darkcyan",
             pch = 5, size = 3)
```

The dataset was already corrected in the following way:
- Removal of samples with less than 10 markers
- Removal of samples with two mating types.


# Number of samples per Site

```{r erste Datensichtung, echo=FALSE}
# of observations per site
number_obs_all <- as.data.frame(T_all %>%
                                  count(Site_1_abrev))
coord_observ_table <- left_join(number_obs_all,coord,by="Site_1_abrev")
kable(select(coord_observ_table[,1:3 ],c(Site_1_abrev,Site,n)), caption = "Number of observations per site")
```

Evtl. später:
Standorte mit weniger als 10 Samples werden entfernt.
Dies lässt danach noch folgende Standorte für die Auswertung zu:

```{r Standorte mit weniger als 3 Samples entfernen, include=FALSE}
# of observations per site
T_all_corr1 <- subset(T_all,Site_1_abrev!="BAR")
T_all_corr2 <- subset(T_all_corr1, Site_1_abrev != "GEN")
```

#Idee: alle Observationen auf einer Zeitachse und nach Standort unterteilt anzeigen

```{r all observations, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(T_all) +
  geom_point(aes(x=Sampling_date, y= fct_rev(Site_1_abrev), color = factor(Nb_markers))) +
  scale_colour_brewer(palette= "Greens") +
  theme_publish(base_family = "Times") +
  labs(title = "Overview of samples in truffle monitoring dataset",
       x = "Sampling year", y = "Sampling site abbreviation",
       colour = "Nb_markers")
```